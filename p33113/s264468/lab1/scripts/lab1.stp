probe begin {
	qnames["ioblock"]++
	qsq_start("ioblock")
}

probe ioblock.request {
	if (execname() == "lab1.out") {
		qs_wait("ioblock")
		qs_run("ioblock")
	}
}

probe ioblock.end {
	if (execname() == "lab1.out") {
		qs_done("ioblock")
	}
}

probe begin {
	qnames["cpu"]++
	qsq_start("cpu")
}

probe scheduler.cpu_on {
	if (!idle && execname() == "lab1.out") {
		qs_wait("cpu")
		qs_run("cpu")
	}
}

probe scheduler.cpu_off {
	if (!idle && execname() == "lab1.out")
		qs_done("cpu")
}

global qnames

function qsq_util_reset(q) {
	u = qsq_utilization(q, 100)
	qsq_start(q)
	return u
}

probe timer.ms(100) {
	printf("{ ")
	foreach (q in qnames) {
		printf("'%s': %d, ", q, qsq_util_reset(q))
	}
	printf("},\n")
}

